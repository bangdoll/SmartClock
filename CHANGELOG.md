# Changelog

所有重要的更新都會記錄在此檔案中。

## [1.2.5] - 2026-01-08

### 新增
- **語音新聞功能 (TTS)**：在新聞卡片新增「朗讀」按鈕，可自動朗讀今日 AI 新聞標題與摘要（支援繁體中文語音）。
- **CarPlay / 車載媒體整合**：支援 MediaSession API，讓新聞播放資訊（標題、時間、圖片）顯示於 CarPlay 或手機鎖定畫面，並可使用車用控制鍵（播放、暫停、上一首、下一首）操作。

## [1.2.4] - 2025-12-30

### 修正
- **手機版彈跳視窗警告**：修正背景自動更新日曆時，因嘗試靜默刷新 Token 而觸發瀏覽器攔截警告的問題。
- **背景更新策略**：網路恢復或定時檢查時，若 Token 過期將不再自動嘗試刷新，避免打擾使用者。

## [1.2.3] - 2025-12-27

### 新增
- **Service Worker**：完整離線支援，App 檔案也會快取
- **資料新鮮度檢查**：自動偵測過期資料並刷新
  - 天氣：30 分鐘
  - 新聞：15 分鐘
  - 地震：10 分鐘
  - 日曆：5 分鐘
- **台灣氣象署地震資料**：改用中央氣象署 API 取代 USGS
  - 同時檢查大區域 (E-A0015-001) 和小區域 (E-A0016-001) 地震報告
  - 自動顯示最新的一筆地震資訊

### 修正
- **輪播面板留白**：減少橫向模式下底部空白區域

---

## [1.2.2] - 2025-12-26

### 新增
- **觸控滑動**：手機/平板可左右滑動切換輪播卡片
- **點擊指示器**：可點擊底部圓點直接跳轉到指定卡片
- **PWA 全螢幕模式**：加入主畫面後以全螢幕開啟，無瀏覽器 UI
- **App Icons**：深藍紫漸層 + AI 神經網路紋理 + 大字時鐘設計
- **離線支援**：天氣/新聞/地震資料快取到 localStorage，離線時使用上次資料
- **網路恢復自動更新**：偵測到網路恢復時自動抓取最新資料
- **新聞點擊連結**：點擊新聞卡片開啟智流網站文章頁面

### 修正
- **Google Calendar 401 錯誤**：Token 過期時自動嘗試刷新
- **登入狀態持久化**：不再每次開網頁都要重新登入 Google
- **主題切換按鈕位置**：橫向手機模式下移至左上角/右移 10%
- **時鐘位置調整**：手機直向下移 20%，橫向右移 10%
- **輪播面板置中**：橫向模式下右側輪播卡片垂直置中

---

## [1.2.1] - 2025-12-25

### 新增
- **天氣資料來源**：改用 Open-Meteo 公開 API 抓取即時天氣
  - 不再需要 OpenWeatherMap API Key
  - 顯示溫度、體感溫度、濕度、風速、氣壓
  - 天氣狀況自動翻譯成繁體中文
- **地震資料來源**：改用 USGS 公開 API 抓取台灣地區地震資料
  - 不再需要中央氣象署 API Key
  - 自動抓取台灣地區（緯度 21-26°N, 經度 119-123°E）最新地震
  - 震央位置自動翻譯成繁體中文

### 變更
- **輪播間隔**：從 10 秒調整為 15 秒

### 效能優化
- **日曆快取**：行程資料儲存在本地，頁面載入時立即顯示（不再顯示載入中）
- **響應式設計**：支援手機、平板、桌面各種螢幕尺寸
  - 768px 以下改為垂直佈局
  - 480px 以下縮小時鐘和卡片尺寸
  - 橫向模式特殊處理

### 修正
- **Calendar 閃爍問題**：加入樂觀 UI，頁面載入時立即顯示「載入中...」狀態

---

## [1.2.0] - 2025-12-25

### 新增
- **記住登入狀態**
  - Token 持久化儲存，重新整理頁面後保持登入
  - 自動追蹤 token 過期時間
  - Token 過期時自動靜默刷新（不需重新點擊登入）
  - 401 錯誤時自動嘗試刷新 token

---

## [1.1.0] - 2025-12-24

### 新增
- **Google Calendar 整合**
  - OAuth 2.0 安全登入功能
  - 自動顯示今日 Google 日曆行程
  - 支援登入/登出狀態切換
  - 完整的 API 錯誤處理與狀態顯示

### 修正
- **Calendar 顯示問題**：修復已登入狀態下仍顯示「請先登入」的問題
- **API 錯誤處理**：當 Google Calendar API 返回錯誤時，正確顯示錯誤訊息而非登入提示

### 變更
- **輪播順序調整**：新聞1-3 → 日曆 → 新聞4-5 → 天氣 → 地震報告
- 完整一輪從 70 秒調整為 80 秒（新增日曆卡片）

---

## [1.0.0] - 2025-12-23

### 初始版本
- 翻頁式數字時鐘動畫
- 智流 Smart Flow 新聞輪播（5 則）
- 即時天氣顯示（OpenWeatherMap API）
- 地震資訊卡片（中央氣象署 API）
- 深色/淺色主題切換
- 響應式設計
